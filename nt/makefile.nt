#
#  Top level makefile for building GNU Emacs on Windows NT
#
#  This file is part of GNU Emacs.
#  
#  GNU Emacs is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2, or (at your option)
#  any later version.
#  
#  GNU Emacs is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#  
#  You should have received a copy of the GNU General Public License
#  along with GNU Emacs; see the file COPYING.  If not, write to
#  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.  */
#
#   Geoff Voelker (voelker@cs.washington.edu)	11-20-93
#						  9-6-94
!include makefile.def

SUBDIRS	      = lib-src src lisp

#
# Build emacs
#
all:;		for %%f in ( $(SUBDIRS) ) do cd ..\%%f & $(MAKE) -f makefile.nt all

#
# Build and install emacs in INSTALL_DIR
#
install:	all
		- mkdir $(INSTALL_DIR)
		for %%f in ( $(SUBDIRS) ) do cd ..\%%f & $(MAKE) -f makefile.nt install
		- $(CP) emacs.bat $(INSTALL_DIR)\bin
		- del /q ..\same-dir.tst
		- del /q $(INSTALL_DIR)\same-dir.tst
		echo SameDirTest > ..\same-dir.tst
		if not exist $(INSTALL_DIR)\same-dir.tst $(MAKE) -f makefile.nt real_install
		- del /q ..\same-dir.tst
		- del /q $(INSTALL_DIR)\same-dir.tst

#
# This installs executables from ..\bin into the installation directory
# without building anything.
#
fast_install:
		- mkdir $(INSTALL_DIR)\data
		$(CP) ..\lib-src\DOC $(INSTALL_DIR)\etc
		- mkdir $(INSTALL_DIR)\bin
		- $(CP) emacs.bat $(INSTALL_DIR)\bin
		- del /q ..\same-dir.tst
		- del /q $(INSTALL_DIR)\same-dir.tst
		echo SameDirTest > ..\same-dir.tst
		if not exist $(INSTALL_DIR)\same-dir.tst $(CP) ..\bin\emacs.exe $(INSTALL_DIR)\bin
		if not exist $(INSTALL_DIR)\same-dir.tst $(CP) ..\bin\etags.exe $(INSTALL_DIR)\bin
		if not exist $(INSTALL_DIR)\same-dir.tst $(CP) ..\bin\ctags.exe $(INSTALL_DIR)\bin
		if not exist $(INSTALL_DIR)\same-dir.tst nmake -f $(MAKE) real_install
		- del /q ..\same-dir.tst
		- del /q $(INSTALL_DIR)\same-dir.tst

real_install:
		- del /q ..\same-dir.tst
		- del /q $(INSTALL_DIR)\same-dir.tst
		echo SameDirTest > ..\same-dir.tst
		- mkdir $(INSTALL_DIR)\etc
		- mkdir $(INSTALL_DIR)\info
		- mkdir $(INSTALL_DIR)\lock
		- mkdir $(INSTALL_DIR)\data
		if not exist $(INSTALL_DIR)\nt\same-dir.tst $(CP_DIR) ..\etc $(INSTALL_DIR)\etc
		if not exist $(INSTALL_DIR)\nt\same-dir.tst $(CP_DIR) ..\info $(INSTALL_DIR)\info
		- del /q ..\same-dir.tst
		- del /q $(INSTALL_DIR)\same-dir.tst

#
# Maintenance
# 
clean:;		- del /q /s *~
		- $(DEL_TREE) deleted
		- $(DEL_TREE) ..\bin
		for %%f in ( $(SUBDIRS) ) do cd ..\%%f & $(MAKE) -f makefile.nt clean
