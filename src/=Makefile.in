# DIST: This is the distribution Makefile for Emacs.  configure can
# DIST: make most of the changes to this file you might want, so try
# DIST: that first.

MAKE = make
# BSD doesn't have it as a default.

CC =gcc
CPP = $(CC) -E -Is -Im
#Note: an alternative is  CPP = /lib/cpp

# Just to avoid uncertainty.
SHELL = /bin/sh

all: doall

doall: xmakefile
	$(MAKE) CC='${CC}' -f xmakefile ${MFLAGS} all

#This is used in making a distribution.
#Do not use it on development directories!
distclean:
	-rm -f paths.h config.h machine.h system.h emacs-* temacs xemacs xmakefile core *~ m/*~ s/*~ \#* *.o

clean:
	-rm -f temacs xemacs xmakefile* core \#* *.o

xemacs: doxemacs

doxemacs: xmakefile
	$(MAKE) CC='${CC}' -f xmakefile ${MFLAGS} xemacs

temacs: dotemacs

dotemacs: xmakefile
	$(MAKE) CC='${CC}' -f xmakefile ${MFLAGS} temacs

# If you have a problem with cc -E here, changing
# the definition of CPP above may fix it.
xmakefile: ymakefile config.h
	-rm -f xmakefile xmakefile.new junk.c junk.cpp
	cp ymakefile junk.c
	$(CPP) junk.c > junk.cpp
	< junk.cpp					\
	sed	-e 's/^#.*//'				\
		-e 's/^[ \f\t][ \f\t]*$$//'		\
		-e 's/^ /	/' 			\
	| sed -n -e '/^..*$$/p' 			\
	> xmakefile.new
	mv -f xmakefile.new xmakefile
	rm -f junk.c

tags TAGS:
	etags [a-z]*.h [a-z]*.c ../lisp/[a-z]*.el ../lisp/term/[a-z]*.el \
	      ../external-lisp/*.el
